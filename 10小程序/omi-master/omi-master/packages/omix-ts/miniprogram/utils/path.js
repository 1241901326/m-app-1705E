"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var OBJECTTYPE = '[object Object]';
var ARRAYTYPE = '[object Array]';
function getUsing(data, paths) {
    if (!paths)
        return;
    var obj = {};
    paths.forEach(function (path, index) {
        var isPath = typeof path === 'string';
        if (!isPath) {
            var key = Object.keys(path)[0];
            var value = path[key];
            if (typeof value !== 'string') {
                var tempPath = value[0];
                if (typeof tempPath === 'string') {
                    var tempVal = getTargetByPath(data, tempPath);
                    obj[key] = value[1] ? value[1](tempVal) : tempVal;
                }
                else {
                    var args_1 = [];
                    tempPath.forEach(function (path) {
                        args_1.push(getTargetByPath(data, path));
                    });
                    obj[key] = value[1].apply(null, args_1);
                }
            }
        }
    });
    return obj;
}
exports.getUsing = getUsing;
function getTargetByPath(origin, path) {
    var arr = path
        .replace(/]/g, '')
        .replace(/\[/g, '.')
        .split('.');
    var current = origin;
    for (var i = 0, len = arr.length; i < len; i++) {
        current = current[arr[i]];
    }
    return current;
}
exports.getTargetByPath = getTargetByPath;
function getPath(obj) {
    if (Object.prototype.toString.call(obj) === '[object Array]') {
        var result_1 = {};
        obj.forEach(function (item) {
            if (typeof item === 'string') {
                result_1[item] = true;
            }
            else {
                var tempPath = item[Object.keys(item)[0]];
                if (typeof tempPath === 'string') {
                    result_1[tempPath] = true;
                }
                else if (typeof tempPath[0] === 'string') {
                    result_1[tempPath[0]] = true;
                }
                else {
                    tempPath[0].forEach(function (path) { return (result_1[path] = true); });
                }
            }
        });
        return result_1;
    }
    return getUpdatePath(obj);
}
exports.getPath = getPath;
function getUpdatePath(data) {
    var result = {};
    dataToPath(data, result);
    return result;
}
exports.getUpdatePath = getUpdatePath;
function dataToPath(data, result) {
    Object.keys(data).forEach(function (key) {
        result[key] = true;
        var type = Object.prototype.toString.call(data[key]);
        if (type === OBJECTTYPE) {
            _objToPath(data[key], key, result);
        }
        else if (type === ARRAYTYPE) {
            _arrayToPath(data[key], key, result);
        }
    });
}
function _objToPath(data, path, result) {
    Object.keys(data).forEach(function (key) {
        result[path + '.' + key] = true;
        delete result[path];
        var type = Object.prototype.toString.call(data[key]);
        if (type === OBJECTTYPE) {
            _objToPath(data[key], path + '.' + key, result);
        }
        else if (type === ARRAYTYPE) {
            _arrayToPath(data[key], path + '.' + key, result);
        }
    });
}
function _arrayToPath(data, path, result) {
    data.forEach(function (item, index) {
        result[path + '[' + index + ']'] = true;
        delete result[path];
        var type = Object.prototype.toString.call(item);
        if (type === OBJECTTYPE) {
            _objToPath(item, path + '[' + index + ']', result);
        }
        else if (type === ARRAYTYPE) {
            _arrayToPath(item, path + '[' + index + ']', result);
        }
    });
}
function needUpdate(diffResult, updatePath) {
    for (var keyA in diffResult) {
        if (updatePath[keyA]) {
            return true;
        }
        for (var keyB in updatePath) {
            if (includePath(keyA, keyB)) {
                return true;
            }
        }
    }
    return false;
}
exports.needUpdate = needUpdate;
function includePath(pathA, pathB) {
    if (pathA.indexOf(pathB) === 0) {
        var next = pathA.substr(pathB.length, 1);
        if (next === '[' || next === '.') {
            return true;
        }
    }
    return false;
}
function fixPath(path) {
    var mpPath = '';
    var arr = path.replace('#-', '').split('-');
    arr.forEach(function (item, index) {
        if (index) {
            if (isNaN(Number(item))) {
                mpPath += '.' + item;
            }
            else {
                mpPath += '[' + item + ']';
            }
        }
        else {
            mpPath += item;
        }
    });
    return mpPath;
}
exports.fixPath = fixPath;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhdGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQTtBQUNwQyxJQUFNLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQTtBQUVsQyxTQUFnQixRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUs7SUFDbEMsSUFBRyxDQUFDLEtBQUs7UUFBRSxPQUFNO0lBQ2pCLElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQTtJQUNkLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFJLEVBQUUsS0FBSztRQUN4QixJQUFNLE1BQU0sR0FBRyxPQUFPLElBQUksS0FBSyxRQUFRLENBQUE7UUFDdkMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLElBQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDaEMsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3ZCLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO2dCQUU3QixJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQ3pCLElBQUksT0FBTyxRQUFRLEtBQUssUUFBUSxFQUFFO29CQUNoQyxJQUFNLE9BQU8sR0FBRyxlQUFlLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFBO29CQUMvQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQTtpQkFDbEQ7cUJBQU07b0JBQ0wsSUFBTSxNQUFJLEdBQUcsRUFBRSxDQUFBO29CQUNmLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQSxJQUFJO3dCQUNuQixNQUFJLENBQUMsSUFBSSxDQUFD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QyxJQUFJLElBQUksS0FBSyxHQUFHLElBQUksSUFBSSxLQUFLLEdBQUcsRUFBRTtZQUNoQyxPQUFPLElBQUksQ0FBQTtTQUNaO0tBQ0Y7SUFDRCxPQUFPLEtBQUssQ0FBQTtBQUNkLENBQUM7QUFFRCxTQUFnQixPQUFPLENBQUMsSUFBSTtJQUMxQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFDZixJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDN0MsR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQUksRUFBRSxLQUFLO1FBQ3RCLElBQUksS0FBSyxFQUFFO1lBQ1QsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUU7Z0JBQ3ZCLE1BQU0sSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFBO2FBQ3JCO2lCQUFNO2dCQUNMLE1BQU0sSUFBSSxHQUFHLEdBQUcsSUFBSSxHQUFHLEdBQUcsQ0FBQTthQUMzQjtTQUNGO2FBQU07WUFDTCxNQUFNLElBQUksSUFBSSxDQUFBO1NBQ2Y7SUFDSCxDQUFDLENBQUMsQ0FBQTtJQUNGLE9BQU8sTUFBTSxDQUFBO0FBQ2YsQ0FBQztBQWZELDBCQWVDIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgT0JKRUNUVFlQRSA9ICdbb2JqZWN0IE9iamVjdF0nXG5jb25zdCBBUlJBWVRZUEUgPSAnW29iamVjdCBBcnJheV0nXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2luZyhkYXRhLCBwYXRocykge1xuICBpZighcGF0aHMpIHJldHVyblxuICBjb25zdCBvYmogPSB7fVxuICBwYXRocy5mb3JFYWNoKChwYXRoLCBpbmRleCkgPT4ge1xuICAgIGNvbnN0IGlzUGF0aCA9IHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJ1xuICAgIGlmICghaXNQYXRoKSB7XG4gICAgICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyhwYXRoKVswXVxuICAgICAgY29uc3QgdmFsdWUgPSBwYXRoW2tleV1cbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG5cbiAgICAgICAgY29uc3QgdGVtcFBhdGggPSB2YWx1ZVswXVxuICAgICAgICBpZiAodHlwZW9mIHRlbXBQYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGNvbnN0IHRlbXBWYWwgPSBnZXRUYXJnZXRCeVBhdGgoZGF0YSwgdGVtcFBhdGgpXG4gICAgICAgICAgb2JqW2tleV0gPSB2YWx1ZVsxXSA/IHZhbHVlWzFdKHRlbXBWYWwpIDogdGVtcFZhbFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGFyZ3MgPSBbXVxuICAgICAgICAgIHRlbXBQYXRoLmZvckVhY2gocGF0aCA9PiB7XG4gICAgICAgICAgICBhcmdzLnB1c2goZ2V0VGFyZ2V0QnlQYXRoKGRhdGEsIHBhdGgpKVxuICAgICAgICAgIH0pXG4gICAgICAgICAgb2JqW2tleV0gPSB2YWx1ZVsxXS5hcHBseShudWxsLCBhcmdzKVxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBvYmpcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRhcmdldEJ5UGF0aChvcmlnaW4sIHBhdGgpIHtcbiAgY29uc3QgYXJyID0gcGF0aFxuICAgIC5yZXBsYWNlKC9dL2csICcnKVxuICAgIC5yZXBsYWNlKC9cXFsvZywgJy4nKVxuICAgIC5zcGxpdCgnLicpXG4gIGxldCBjdXJyZW50ID0gb3JpZ2luXG4gIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBjdXJyZW50ID0gY3VycmVudFthcnJbaV1dXG4gIH1cbiAgcmV0dXJuIGN1cnJlbnRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFBhdGgob2JqKSB7XG4gIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJykge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9XG4gICAgb2JqLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJlc3VsdFtpdGVtXSA9IHRydWVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHRlbXBQYXRoID0gaXRlbVtPYmplY3Qua2V5cyhpdGVtKVswXV1cbiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wUGF0aCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXN1bHRbdGVtcFBhdGhdID0gdHJ1ZVxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0ZW1wUGF0aFswXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXN1bHRbdGVtcFBhdGhbMF1dID0gdHJ1ZVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRlbXBQYXRoWzBdLmZvckVhY2gocGF0aCA9PiAocmVzdWx0W3BhdGhdID0gdHJ1ZSkpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIHJldHVybiByZXN1bHRcbiAgfVxuICByZXR1cm4gZ2V0VXBkYXRlUGF0aChvYmopXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVcGRhdGVQYXRoKGRhdGEpIHtcbiAgY29uc3QgcmVzdWx0ID0ge31cbiAgZGF0YVRvUGF0aChkYXRhLCByZXN1bHQpXG4gIHJldHVybiByZXN1bHRcbn1cblxuZnVuY3Rpb24gZGF0YVRvUGF0aChkYXRhLCByZXN1bHQpIHtcbiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrZXkgPT4ge1xuICAgIHJlc3VsdFtrZXldID0gdHJ1ZVxuICAgIGNvbnN0IHR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZGF0YVtrZXldKVxuICAgIGlmICh0eXBlID09PSBPQkpFQ1RUWVBFKSB7XG4gICAgICBfb2JqVG9QYXRoKGRhdGFba2V5XSwga2V5LCByZXN1bHQpXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBBUlJBWVRZUEUpIHtcbiAgICAgIF9hcnJheVRvUGF0aChkYXRhW2tleV0sIGtleSwgcmVzdWx0KVxuICAgIH1cbiAgfSlcbn1cblxuZnVuY3Rpb24gX29ialRvUGF0aChkYXRhLCBwYXRoLCByZXN1bHQpIHtcbiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrZXkgPT4ge1xuICAgIHJlc3VsdFtwYXRoICsgJy4nICsga2V5XSA9IHRydWVcbiAgICBkZWxldGUgcmVzdWx0W3BhdGhdXG4gICAgY29uc3QgdHlwZSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChkYXRhW2tleV0pXG4gICAgaWYgKHR5cGUgPT09IE9CSkVDVFRZUEUpIHtcbiAgICAgIF9vYmpUb1BhdGgoZGF0YVtrZXldLCBwYXRoICsgJy4nICsga2V5LCByZXN1bHQpXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBBUlJBWVRZUEUpIHtcbiAgICAgIF9hcnJheVRvUGF0aChkYXRhW2tleV0sIHBhdGggKyAnLicgKyBrZXksIHJlc3VsdClcbiAgICB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIF9hcnJheVRvUGF0aChkYXRhLCBwYXRoLCByZXN1bHQpIHtcbiAgZGF0YS5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgIHJlc3VsdFtwYXRoICsgJ1snICsgaW5kZXggKyAnXSddID0gdHJ1ZVxuICAgIGRlbGV0ZSByZXN1bHRbcGF0aF1cbiAgICBjb25zdCB0eXBlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZW0pXG4gICAgaWYgKHR5cGUgPT09IE9CSkVDVFRZUEUpIHtcbiAgICAgIF9vYmpUb1BhdGgoaXRlbSwgcGF0aCArICdbJyArIGluZGV4ICsgJ10nLCByZXN1bHQpXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBBUlJBWVRZUEUpIHtcbiAgICAgIF9hcnJheVRvUGF0aChpdGVtLCBwYXRoICsgJ1snICsgaW5kZXggKyAnXScsIHJlc3VsdClcbiAgICB9XG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBuZWVkVXBkYXRlKGRpZmZSZXN1bHQsIHVwZGF0ZVBhdGgpIHtcbiAgZm9yIChsZXQga2V5QSBpbiBkaWZmUmVzdWx0KSB7XG4gICAgaWYgKHVwZGF0ZVBhdGhba2V5QV0pIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGZvciAobGV0IGtleUIgaW4gdXBkYXRlUGF0aCkge1xuICAgICAgaWYgKGluY2x1ZGVQYXRoKGtleUEsIGtleUIpKSB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuXG5mdW5jdGlvbiBpbmNsdWRlUGF0aChwYXRoQSwgcGF0aEIpIHtcbiAgaWYgKHBhdGhBLmluZGV4T2YocGF0aEIpID09PSAwKSB7XG4gICAgY29uc3QgbmV4dCA9IHBhdGhBLnN1YnN0cihwYXRoQi5sZW5ndGgsIDEpXG4gICAgaWYgKG5leHQgPT09ICdbJyB8fCBuZXh0ID09PSAnLicpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZml4UGF0aChwYXRoKSB7XG4gIGxldCBtcFBhdGggPSAnJ1xuICBjb25zdCBhcnIgPSBwYXRoLnJlcGxhY2UoJyMtJywgJycpLnNwbGl0KCctJylcbiAgYXJyLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgaWYgKGluZGV4KSB7XG4gICAgICBpZiAoaXNOYU4oTnVtYmVyKGl0ZW0pKSkge1xuICAgICAgICBtcFBhdGggKz0gJy4nICsgaXRlbVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbXBQYXRoICs9ICdbJyArIGl0ZW0gKyAnXSdcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbXBQYXRoICs9IGl0ZW1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBtcFBhdGhcbn1cbiJdfQ==